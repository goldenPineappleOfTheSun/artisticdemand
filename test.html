<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
	<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/2.1.0/mocha.css">
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/6.2.1/mocha.js"></script>
	  <script>
	    mocha.setup('bdd');
	    const loc = window.location;
	    const req = window.location.search.substr(1).split('&').reduce((acc, cur) => {let x = cur.split('='); acc[x[0]] = x[1]; return acc;}, {})   
	  </script>

	  <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/2.0.0/chai.js"></script>
	  <script src="https://cdn.jsdelivr.net/npm/chai-http@4.3.0/dist/chai-http.js"></script>
	  <script>
		chai.use(chaiHttp);
	    var assert = chai.assert;
	  </script>
	</head>

	<div id="mocha"></div>

	<script>
		describe('Check table schema', function() {
			this.timeout(15000); 
			it('First of all lets compare databases', (done) => {
				$.ajax({
					url: `comparedatabases?internalsecret=${req.internalsecret}`,
					method: 'get',
					success(data) {
						assertAsync(function() {
							assert.equal(data[0], '1', data);
						}, done)
					},
					error(data) {
						assertAsync(function() {
							assert.equal(data[0], '1', data);
						}, done)
					}
				})
			})
		})

		function assertAsync(callback, done) {
			let isError = false;
			try {
				callback();
			} 
			catch (err) {
				isError = true;
				done(err);
			}
			finally {
				if (!isError)
					done();
			}
		}

		$(document).ready(() => {
			mocha.run();
		})
	</script>
</body>
</html>